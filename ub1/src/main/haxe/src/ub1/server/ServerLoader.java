// Generated by Haxe 4.1.5
package ub1.server;

import haxe.root.*;

@SuppressWarnings(value={"rawtypes", "unchecked"})
public class ServerLoader extends haxe.lang.HxObject
{
	public ServerLoader(haxe.lang.EmptyObject empty)
	{
	}
	
	
	public ServerLoader()
	{
		//line 15 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
		ub1.server.ServerLoader.__hx_ctor_ub1_server_ServerLoader(this);
	}
	
	
	protected static void __hx_ctor_ub1_server_ServerLoader(ub1.server.ServerLoader __hx_this)
	{
	}
	
	
	public static ub1.core.Page loadRoot(ub1.server.dom.HtmlDocument doc)
	{
		//line 18 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
		ub1.server.dom.HtmlElement root = ub1.lib.DomTools.domGetRootElement(doc);
		//line 19 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
		ub1.core.Page ret = new ub1.core.Page(doc, ub1.server.ServerLoader.getElementProps(root), null);
		//line 20 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
		ub1.server.ServerLoader.loadChildren(ret, root, true);
		//line 21 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
		return ret;
	}
	
	
	public static java.lang.Object getElementProps(ub1.server.dom.HtmlElement dom)
	{
		//line 25 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
		java.lang.Object ret = new haxe.lang.DynamicObject(new java.lang.String[]{"dom"}, new java.lang.Object[]{dom}, new java.lang.String[]{}, new double[]{});
		//line 26 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
		{
			//line 26 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
			java.lang.Object a = ((java.lang.Object) (new haxe.ds._StringMap.StringMapValueIterator<ub1.server.dom.HtmlAttribute>(((haxe.ds.StringMap<ub1.server.dom.HtmlAttribute>) (((haxe.IMap<java.lang.String, ub1.server.dom.HtmlAttribute>) (dom.attributes) )) ))) );
			//line 26 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
			while (haxe.lang.Runtime.toBool(((java.lang.Boolean) (haxe.lang.Runtime.callField(a, "hasNext", null)) )))
			{
				//line 26 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
				ub1.server.dom.HtmlAttribute a1 = ((ub1.server.dom.HtmlAttribute) (haxe.lang.Runtime.callField(a, "next", null)) );
				//line 27 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
				if (haxe.lang.Runtime.valEq(a1.quote, "[")) 
				{
					//line 28 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
					a1.value = ( ( "[[" + a1.value ) + "]]" );
				}
				
			}
			
		}
		
		//line 31 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
		{
			//line 31 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
			int _g = 0;
			//line 31 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
			haxe.root.Array<java.lang.String> _g1 = ub1.lib.DomTools.domAttributeNames(dom);
			//line 31 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
			while (( _g < _g1.length ))
			{
				//line 31 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
				java.lang.String k = _g1.__get(_g);
				//line 31 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
				 ++ _g;
				//line 32 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
				java.lang.String v = ub1.lib.DomTools.domGet(dom, k);
				//line 33 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
				if (((java.lang.String) (((java.lang.Object) (k) )) ).startsWith(haxe.lang.Runtime.toString(":"))) 
				{
					//line 34 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
					if (haxe.lang.Runtime.valEq(k, ":name")) 
					{
						//line 35 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
						java.lang.String __temp_expr1 = haxe.lang.Runtime.toString(haxe.lang.Runtime.setField(ret, "name", v));
					}
					else
					{
						//line 37 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
						haxe.lang.Runtime.setField(ret, "values", ub1.lib.PropertyTools.set(haxe.lang.Runtime.getField(ret, "values", true), haxe.lang.StringExt.substr(k, 1, null), v));
					}
					
					//line 39 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
					ub1.lib.DomTools.domSet(dom, k, null);
				}
				else
				{
					//line 40 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
					if (ub1.reactivity.ReParser.isDynamic(v)) 
					{
						//line 41 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
						haxe.lang.Runtime.setField(ret, "attr", ub1.lib.PropertyTools.set(haxe.lang.Runtime.getField(ret, "attr", true), k, v));
						//line 42 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
						ub1.lib.DomTools.domSet(dom, k, "");
					}
					
				}
				
			}
			
		}
		
		//line 45 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
		int i = 0;
		//line 46 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
		{
			//line 46 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
			int _g2 = 0;
			//line 46 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
			haxe.root.Array<ub1.server.dom.HtmlNode> _g3 = dom.children;
			//line 46 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
			while (( _g2 < _g3.length ))
			{
				//line 46 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
				ub1.server.dom.HtmlNode n = _g3.__get(_g2);
				//line 46 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
				 ++ _g2;
				//line 47 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
				if (( n.type == 2 )) 
				{
					//line 48 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
					java.lang.String v1 = ub1.lib.DomTools.domGetNodeText(((ub1.server.dom.HtmlText) (n) ));
					//line 49 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
					if (ub1.reactivity.ReParser.isDynamic(v1)) 
					{
						//line 50 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
						if (( ((haxe.root.Array<java.lang.Object>) (haxe.lang.Runtime.getField(ret, "texts", true)) ) == null )) 
						{
							//line 50 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
							haxe.root.Array<java.lang.Object> __temp_expr2 = ((haxe.root.Array<java.lang.Object>) (haxe.lang.Runtime.setField(ret, "texts", new haxe.root.Array<java.lang.Object>(new java.lang.Object[]{}))) );
						}
						
						//line 51 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
						((haxe.root.Array<java.lang.Object>) (haxe.lang.Runtime.getField(ret, "texts", true)) ).push(new haxe.lang.DynamicObject(new java.lang.String[]{"text"}, new java.lang.Object[]{v1}, new java.lang.String[]{"index"}, new double[]{((double) (((double) (i) )) )}));
						//line 52 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
						ub1.lib.DomTools.domSetNodeText(((ub1.server.dom.HtmlText) (n) ), " ");
					}
					
				}
				
				//line 55 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
				 ++ i;
			}
			
		}
		
		//line 57 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
		return ret;
	}
	
	
	public static void loadChildren(ub1.core.Element p, ub1.server.dom.HtmlElement dom, java.lang.Object firstLevel)
	{
		//line 61 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
		boolean firstLevel1 = ( (haxe.lang.Runtime.eq(firstLevel, null)) ? (false) : (haxe.lang.Runtime.toBool(((java.lang.Boolean) (firstLevel) ))) );
		//line 61 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
		int _g = 0;
		//line 61 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
		haxe.root.Array<ub1.server.dom.HtmlNode> _g1 = dom.children;
		//line 61 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
		while (( _g < _g1.length ))
		{
			//line 61 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
			ub1.server.dom.HtmlNode n = _g1.__get(_g);
			//line 61 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
			 ++ _g;
			//line 62 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
			if (( n.type == 1 )) 
			{
				//line 63 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
				ub1.server.dom.HtmlElement child = ((ub1.server.dom.HtmlElement) (n) );
				//line 64 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
				java.lang.Object props = ub1.server.ServerLoader.getElementProps(child);
				//line 65 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
				if (( ( ( ( ( haxe.lang.Runtime.toString(haxe.lang.Runtime.getField(props, "name", true)) != null ) || ( ! (( haxe.lang.Runtime.getField(props, "values", true) == null )) ) ) || ( ! (( haxe.lang.Runtime.getField(props, "attr", true) == null )) ) ) || ( ((haxe.root.Array<java.lang.Object>) (haxe.lang.Runtime.getField(props, "texts", true)) ) != null ) ) || firstLevel1 )) 
				{
					//line 70 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
					ub1.core.Element e = null;
					//line 70 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
					{
						//line 70 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
						java.lang.String __temp_svar1 = (child.name);
						//line 70 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
						boolean __temp_executeDef2 = true;
						//line 70 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
						if (( __temp_svar1 != null )) 
						{
							//line 70 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
							switch (__temp_svar1.hashCode())
							{
								case 2044322:
								{
									//line 70 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
									if (__temp_svar1.equals("BODY")) 
									{
										//line 70 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
										__temp_executeDef2 = false;
										//line 70 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
										e = new ub1.core.Body(p, props);
									}
									
									//line 70 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
									break;
								}
								
								
								case 2213344:
								{
									//line 70 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
									if (__temp_svar1.equals("HEAD")) 
									{
										//line 70 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
										__temp_executeDef2 = false;
										//line 70 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
										e = new ub1.core.Head(p, props);
									}
									
									//line 70 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
									break;
								}
								
								
							}
							
						}
						
						//line 70 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
						if (__temp_executeDef2) 
						{
							//line 70 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
							e = new ub1.core.Element(p, props);
						}
						
					}
					
					//line 75 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
					ub1.server.ServerLoader.loadChildren(e, child, null);
				}
				else
				{
					//line 77 "/Users/fabrizio/ubimate/oss/ub1/ub1-core/src/ub1/server/ServerLoader.hx"
					ub1.server.ServerLoader.loadChildren(p, child, null);
				}
				
			}
			
		}
		
	}
	
	
}


